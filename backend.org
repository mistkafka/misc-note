#+TITLE: 后端杂项

* 如何打好日志
  看了很多篇关于如何打日志的博客，记录如下：
** 日志分级
** 哪些地方打日志？
   - 与其它子系统打交道时
   - 访问资源时
   - try-cache
   - 重要的状态变更处
   - 重要的函数入口、出口
   - 系统初始化
   - 重要业务逻辑

** 一条日志的组成部分
   - 基础信息：如哪个系统、哪个用户、哪个请求、哪个线程等
   - 描述: 发生了什么？
   - 上下文：相关的重要上下文变量
   - 如果是异常，带上track

** 打日志的禁忌
   - 到处乱打，不利于找日志，且影响性能
   - 分级不对
** 博客的连接
   [[http://www.cnblogs.com/luguo3000/p/3543487.html]]
   [[http://macrochen.iteye.com/blog/1399082]]
   [[http://www.importnew.com/28024.html]]
   [[http://www.infoq.com/cn/articles/why-and-how-log]]
   [[http://tech.lede.com/2017/06/30/rd/server/loggingHabit/]]

* nginx proxy header
  nginx proxy会不会默认转发所有header我不知道。但是，它一定不会转发带有下划线的header。
  我今天就被这个坑到了，谁会想到“下划线”不是合法的header名字？老天爷～ 然后原本好好的，上了nginx转发之后，就挂了。

  在fix这个问题的时候，我看到，自己实现这个逻辑的时候，auth token的header name竟然还支持配置。当时真的是多此一举。而且还半途而废，因为后端可以配置了，而前端却没有跟着配置走，是hardcode的。估计当时写前端的时候，也觉得自己脑子瓦特了，所以就半途而废了。
